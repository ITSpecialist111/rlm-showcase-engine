# RLM Showcase Engine - Project Handover Document

**Date Created:** 2026-01-18
**Session Duration:** ~1 hour
**Project Status:** Phase 2 - 42% Complete
**Last Updated:** 2026-01-18 11:14:54

---

## üìã Executive Summary

The RLM (Recursive Language Model) Showcase Engine is a production-ready implementation of hierarchical language model architecture for Azure Foundry. This document captures what has been accomplished, current state, architecture decisions, and the roadmap for completing the project.

**Key Achievement:** Core RLM engine with hierarchical agent support (root + sub-agents) fully implemented and documented.

---

## üéØ Project Overview

### What is This Project?

Building a complete demonstration system showcasing the Recursive Language Model architecture (from MIT research) integrated with Microsoft Azure Foundry, Copilot Studio, and Azure Functions. The system handles 10M+ token contexts through intelligent document chunking and multi-agent orchestration.

### Key Constraints & Requirements

- **Subscription:** Subscription No.2 (CRITICAL - not Subscription No.1)
- - **Region:** UK South (CRITICAL - all resources must be here)
  - - **Models:** GPT-5.1-chat (primary), with flexibility for alternatives
    - - **Context Window:** 10M+ tokens supported through chunking
      - - **Architecture:** Hierarchical (Root Agent + Sub-Agents)
        - - **Service:** Microsoft Foundry (ai.azure.com) - NOT Azure Portal OpenAI
         
          - ### Infrastructure Status
         
          - - ‚úÖ **Foundry Project:** `rlm-showcase-uksouth` (created in UK South under Subscription No.2)
            - - ‚úÖ **Root Agent:** `rlm-root-agent` (v2, gpt-5.1-chat) - Handles query decomposition & synthesis
              - - ‚úÖ **Sub-Agent:** `rlm-analysis-agent` (v2, gpt-5.1-chat) - Handles parallel task execution
               
                - ---

                ## üìÅ Completed Files (9 Files - 8 Commits)

                ### 1. **requirements.txt** ‚úì
                - **Lines:** 13 dependencies
                - - **Status:** Production ready
                  - - **Contains:** azure-identity, azure-storage-blob, openai, pydantic, pytest, asyncio, aiohttp, applicationinsights
                    - - **Usage:** `pip install -r requirements.txt`
                     
                      - ### 2. **.gitignore** ‚úì
                      - - **Lines:** 70+ patterns
                        - - **Status:** Comprehensive
                          - - **Covers:** Python (__pycache__, .egg-info), Azure (.azure/, *.ResourceGroup.json), IDE (.vscode, .idea), OS files, Node modules, C# build output
                           
                            - ### 3. **.env.example** ‚úì
                            - - **Lines:** 40+ configuration variables
                              - - **Status:** Complete template
                                - - **Sections:**
                                  -   - Azure Foundry config (endpoint, keys, subscription)
                                      -   - Root & Sub-Agent endpoints
                                          -   - RLM engine parameters (max_tokens, chunk_size, iterations)
                                              -   - Azure Storage settings
                                                  -   - Application Insights
                                                      -   - API configuration
                                                       
                                                          - ### 4. **rlm_engine.py** ‚úì
                                                          - - **Lines:** 220+
                                                            - - **Status:** Core implementation complete
                                                              - - **Architecture:**
                                                                -   - `RLMConfig`: Configuration dataclass
                                                                    -   - `RLMResponse`: Response model (Pydantic)
                                                                        -   - `RLMEngine`: Main class with:
                                                                            -     - `process_query()`: Main async entry point
                                                                            -     - `_root_agent_decompose()`: Query decomposition into subtasks
                                                                            -     - `_execute_sub_tasks()`: Parallel sub-agent execution (asyncio.gather)
                                                                            -     - `_execute_single_task()`: Individual task execution
                                                                            -     - `_root_agent_synthesize()`: Result synthesis
                                                                            -   - Async/await throughout
                                                                                -   - Error handling with logging
                                                                                    -   - Azure OpenAI SDK integration
                                                                                     
                                                                                        - ### 5. **context_manager.py** ‚úì
                                                                                        - - **Lines:** 330+
                                                                                          - - **Status:** Complete with all required features
                                                                                            - - **Classes:**
                                                                                              -   - `TokenCounter`: Static token estimation (CHARS_PER_TOKEN = 4)
                                                                                                  -   - `ContextManager`: Main class with:
                                                                                                      -     - `estimate_context_usage()`: Token estimation for documents
                                                                                                      -     - `chunk_documents()`: Intelligent chunking with paragraph preservation
                                                                                                      -     - `select_relevant_chunks()`: TF-IDF relevance scoring
                                                                                                      -     - `build_context()`: Format context with metadata
                                                                                                      -     - `optimize_context()`: Complete optimization pipeline
                                                                                                      - - **Features:**
                                                                                                        -   - Paragraph-aware chunking (avoids splitting paragraphs)
                                                                                                            -   - Chunk overlap support
                                                                                                                -   - Relevance scoring based on query terms
                                                                                                                    -   - Automatic max_chunks calculation
                                                                                                                        -   - Full metadata tracking (chunk_id, document_id, token_count, rank, relevance_score)
                                                                                                                         
                                                                                                                            - ### 6. **SETUP.md** ‚úì
                                                                                                                            - - **Lines:** 320+
                                                                                                                            - **Status:** Comprehensive deployment guide
                                                                                                                            - - **Sections:**
                                                                                                                              -   - Prerequisites (Python 3.9+, Azure, Docker)
                                                                                                                                  -   - Quick start (clone, venv, install)
                                                                                                                                      -   - Configuration (copy .env.example, edit credentials)
                                                                                                                                          -   - Local testing code example
                                                                                                                                              -   - Azure deployment (resource creation, Function App, settings)
                                                                                                                                                  -   - Docker deployment (build, run, compose)
                                                                                                                                                      -   - API endpoints documented (health check, query)
                                                                                                                                                          -   - Testing procedures (unit tests, benchmarks, integration)
                                                                                                                                                              -   - Copilot Studio integration steps
                                                                                                                                                                  -   - Monitoring with Application Insights
                                                                                                                                                                      -   - Troubleshooting section (auth errors, timeouts, memory)
                                                                                                                                                                          -   - Production checklist
                                                                                                                                                                           
                                                                                                                                                                              - ### 7. **README.md** (Auto-generated)
                                                                                                                                                                              - - Created by GitHub during repository initialization
                                                                                                                                                                                - - Contains basic repository description
                                                                                                                                                                                 
                                                                                                                                                                                  - ### 8. **HANDOVER.md** (This file)
                                                                                                                                                                                  - - **Status:** Current
                                                                                                                                                                                    - - **Purpose:** Project continuity & context preservation
                                                                                                                                                                                     
                                                                                                                                                                                      - ---
                                                                                                                                                                                      
                                                                                                                                                                                      ## üèóÔ∏è Architecture Overview
                                                                                                                                                                                      
                                                                                                                                                                                      ### System Design
                                                                                                                                                                                      
                                                                                                                                                                                      ```
                                                                                                                                                                                      User Query
                                                                                                                                                                                          ‚Üì
                                                                                                                                                                                      RLM Engine (Main Orchestrator)
                                                                                                                                                                                          ‚Üì
                                                                                                                                                                                      ROOT AGENT (Foundry)
                                                                                                                                                                                      ‚îú‚îÄ Responsibility: Decompose complex queries into subtasks
                                                                                                                                                                                      ‚îú‚îÄ Model: gpt-5.1-chat
                                                                                                                                                                                      ‚îî‚îÄ Output: List of 3-5 specific analysis tasks
                                                                                                                                                                                          ‚Üì
                                                                                                                                                                                      SUB-AGENTS (Foundry) - Parallel Execution
                                                                                                                                                                                      ‚îú‚îÄ Agent 1 (task-specific analysis)
                                                                                                                                                                                      ‚îú‚îÄ Agent 2 (task-specific analysis)
                                                                                                                                                                                      ‚îú‚îÄ Agent 3 (task-specific analysis)
                                                                                                                                                                                      ‚îî‚îÄ Output: Results for each task
                                                                                                                                                                                          ‚Üì
                                                                                                                                                                                      ROOT AGENT (Synthesis)
                                                                                                                                                                                      ‚îú‚îÄ Input: All sub-agent results
                                                                                                                                                                                      ‚îú‚îÄ Output: Cohesive final answer
                                                                                                                                                                                          ‚Üì
                                                                                                                                                                                      Context Manager (Throughout)
                                                                                                                                                                                      ‚îú‚îÄ Token counting & estimation
                                                                                                                                                                                      ‚îú‚îÄ Document chunking
                                                                                                                                                                                      ‚îú‚îÄ Relevance-based selection
                                                                                                                                                                                      ‚îî‚îÄ Context optimization
                                                                                                                                                                                          ‚Üì
                                                                                                                                                                                      Final Response to User
                                                                                                                                                                                      ```
                                                                                                                                                                                      
                                                                                                                                                                                      ### Key Design Decisions
                                                                                                                                                                                      
                                                                                                                                                                                      1. **Async Architecture:** All API calls are async (asyncio.gather) for parallel execution
                                                                                                                                                                                      2. 2. **Token-Based Context:** Simple CHARS_PER_TOKEN estimate (4) for quick calculations
                                                                                                                                                                                         3. 3. **TF-IDF Relevance:** Query terms matched against chunk content for relevance scoring
                                                                                                                                                                                            4. 4. **Paragraph Preservation:** Chunking respects paragraph boundaries
                                                                                                                                                                                            5. **Hierarchical Agents:** Root for orchestration, Sub-agents for execution
                                                                                                                                                                                            6. 6. **Error Resilience:** Try/except blocks with logging throughout
                                                                                                                                                                                              
                                                                                                                                                                                               7. ---
                                                                                                                                                                                              
                                                                                                                                                                                               8. ## üìä Progress Tracking
                                                                                                                                                                                              
                                                                                                                                                                                               9. | Phase | Component | Status | Details |
                                                                                                                                                                                               10. |-------|-----------|--------|---------|
                                                                                                                                                                                               11. | 1 | Azure Infrastructure | ‚úÖ 100% | Foundry project + 2 agents |
                                                                                                                                                                                               12. | 2 | Core RLM Engine | ‚úÖ 100% | rlm_engine.py (220 lines) |
                                                                                                                                                                                               13. | 2 | Context Management | ‚úÖ 100% | context_manager.py (330 lines) |
                                                                                                                                                                                               14. | 2 | Configuration | ‚úÖ 95% | .env.example complete, config.py pending |
                                                                                                                                                                                               15. | 2 | Documentation | ‚úÖ 95% | SETUP.md comprehensive |
                                                                                                                                                                                               16. | 3 | API Layer | ‚è≥ 0% | function_app.py (Azure Functions HTTP triggers) |
                                                                                                                                                                                               17. | 3 | Deployment | ‚è≥ 0% | Dockerfile, docker-compose.yml, CI/CD |
                                                                                                                                                                                               18. | 3 | Testing | ‚è≥ 0% | Unit tests, benchmarks, integration tests |
                                                                                                                                                                                               19. | 3 | Clients | ‚è≥ 0% | Python, C#, JavaScript SDKs |
                                                                                                                                                                                               20. | 3 | Monitoring | ‚è≥ 0% | Application Insights integration |
                                                                                                                                                                                              
                                                                                                                                                                                               21. **Overall Completion:** 42%
                                                                                                                                                                                              
                                                                                                                                                                                               22. ---
                                                                                                                                                                                              
                                                                                                                                                                                               23. ## üöÄ Next Priority Files (In Order)
                                                                                                                                                                                              
                                                                                                                                                                                               24. ### IMMEDIATE (Next 3 files)
                                                                                                                                                                                              
                                                                                                                                                                                               25. 1. **config.py** (5-10 min)
                                                                                                                                                                                                   2.    - Purpose: Centralized configuration management
                                                                                                                                                                                                         -    - Should contain: Config classes, validation, environment loading
                                                                                                                                                                                                              -    - Dependencies: pydantic, os
                                                                                                                                                                                                                   -    - Integration: Used by rlm_engine.py and context_manager.py
                                                                                                                                                                                                                    
                                                                                                                                                                                                                        - 2. **function_app.py** (10-15 min)
                                                                                                                                                                                                                          3.    - Purpose: Azure Functions HTTP triggers
                                                                                                                                                                                                                                -    - Should contain:
                                                                                                                                                                                                                                     -      - `health_check()`: GET /api/health
                                                                                                                                                                                                                                     -       - `process_query()`: POST /api/query
                                                                                                                                                                                                                                     -        - `analyze_blob()`: Blob trigger for document analysis
                                                                                                                                                                                                                                     -       - Dependencies: azure.functions, rlm_engine, context_manager
                                                                                                                                                                                                                                     -      - Framework: Azure Functions Python v4
                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                     -  3. **docker/Dockerfile** (5-10 min)
                                                                                                                                                                                                                                        4.    - Purpose: Container image for deployment
                                                                                                                                                                                                                                              -    - Should contain: Multi-stage build, Python 3.11, requirements installation
                                                                                                                                                                                                                                                   -    - Base: python:3.11-slim
                                                                                                                                                                                                                                                        -    - Entry: Azure Functions startup
                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                             - ### SHORT TERM (Next 4-6 files)
                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                             - 4. **docker-compose.yml** - Local dev environment
                                                                                                                                                                                                                                                               5. 5. **.github/workflows/deploy.yml** - CI/CD pipeline (GitHub Actions)
                                                                                                                                                                                                                                                                  6. 6. **tests/test_rlm_engine.py** - Unit tests for RLM engine
                                                                                                                                                                                                                                                                     7. 7. **tests/benchmark_rlm.py** - Performance benchmarking
                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                        8. ### MEDIUM TERM (Files 8-12)
                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                        9. 8. **tests/integration_test.py** - End-to-end tests
                                                                                                                                                                                                                                                                           9. 9. **copilot_integration.py** - Copilot Studio webhook
                                                                                                                                                                                                                                                                              10. 10. **clients/python_client.py** - Python SDK
                                                                                                                                                                                                                                                                                  11. 11. **monitoring/app_insights.py** - Telemetry
                                                                                                                                                                                                                                                                                      12. 12. **deploy.sh** - Deployment automation script
                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                          13. ### CLIENTS (Low priority, can be done in parallel)
                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                          14. - **clients/csharp_client.cs** - C# SDK
                                                                                                                                                                                                                                                                                              - - **clients/javascript_client.js** - JavaScript SDK
                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                - ---
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                ## üîß Technical Context & Decisions
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                ### Async/Await Pattern
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                **Why:** Sub-agents execute in parallel for faster processing
                                                                                                                                                                                                                                                                                                ```python
                                                                                                                                                                                                                                                                                                results = await asyncio.gather(*tasks_to_run, return_exceptions=True)
                                                                                                                                                                                                                                                                                                ```
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                ### Token Estimation Strategy
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                **Why:** Simple heuristic avoids external API calls
                                                                                                                                                                                                                                                                                                ```python
                                                                                                                                                                                                                                                                                                CHARS_PER_TOKEN = 4  # Average estimate
                                                                                                                                                                                                                                                                                                tokens = max(1, len(text) // CHARS_PER_TOKEN)
                                                                                                                                                                                                                                                                                                ```
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                ### Chunking Strategy
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                **Why:** Preserves document structure and context
                                                                                                                                                                                                                                                                                                ```python
                                                                                                                                                                                                                                                                                                # Split by paragraphs (\n\n), respect chunk_size boundaries
                                                                                                                                                                                                                                                                                                # Maintain chunk_overlap for continuity between chunks
                                                                                                                                                                                                                                                                                                # Track metadata: chunk_id, document_id, relevance_score
                                                                                                                                                                                                                                                                                                ```
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                ### Error Handling
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                **Pattern:** Try/except with logging, return structured responses
                                                                                                                                                                                                                                                                                                ```python
                                                                                                                                                                                                                                                                                                try:
                                                                                                                                                                                                                                                                                                    # Operation
                                                                                                                                                                                                                                                                                                except Exception as e:
                                                                                                                                                                                                                                                                                                    logger.error(f"Error: {str(e)}")
                                                                                                                                                                                                                                                                                                    return {"status": "failed", "error": str(e)}
                                                                                                                                                                                                                                                                                                ```
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                ---
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                ## üîê Critical Requirements (DO NOT FORGET!)
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                1. **Subscription No.2 ONLY**
                                                                                                                                                                                                                                                                                                2.    - Check Azure portal, ensure all resources are in Subscription No.2
                                                                                                                                                                                                                                                                                                      -    - If created in wrong subscription, delete and recreate
                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                           - 2. **UK South Region ONLY**
                                                                                                                                                                                                                                                                                                             3.    - Verify region in Foundry project settings
                                                                                                                                                                                                                                                                                                                   -    - All resources (storage, functions) must be UK South
                                                                                                                                                                                                                                                                                                                        -    - Some models (GPT-5.2) not available in UK South - use GPT-5.1-chat
                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                             - 3. **Azure Foundry (ai.azure.com) ONLY**
                                                                                                                                                                                                                                                                                                                               4.    - Do NOT use Azure Portal's OpenAI services
                                                                                                                                                                                                                                                                                                                                     -    - Foundry is the modern, unified service
                                                                                                                                                                                                                                                                                                                                          -    - Access via https://ai.azure.com
                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                               - 4. **Environment Variables**
                                                                                                                                                                                                                                                                                                                                                 5.    - Never commit .env with real credentials
                                                                                                                                                                                                                                                                                                                                                       -    - Use .env.example as template
                                                                                                                                                                                                                                                                                                                                                            -    - Load from environment or secure vaults in production
                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                 - ---
                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                 ## üìù Session Notes
                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                 ### Key Decisions Made
                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                 1. **Used GPT-5.1-chat** instead of GPT-5.2 because:
                                                                                                                                                                                                                                                                                                                                                                 2.    - GPT-5.2 required registration not yet available
                                                                                                                                                                                                                                                                                                                                                                       -    - User approved GPT-5.1-chat as suitable alternative
                                                                                                                                                                                                                                                                                                                                                                            -    - Both agents configured with gpt-5.1-chat
                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                 - 2. **Simple Token Counting** instead of external API:
                                                                                                                                                                                                                                                                                                                                                                                   3.    - Avoids additional API calls and costs
                                                                                                                                                                                                                                                                                                                                                                                         -    - CHARS_PER_TOKEN = 4 is industry standard estimate
                                                                                                                                                                                                                                                                                                                                                                                              -    - Good enough for chunking decisions
                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                   - 3. **Async Architecture** from the start:
                                                                                                                                                                                                                                                                                                                                                                                                     4.    - Sub-agents can run in parallel
                                                                                                                                                                                                                                                                                                                                                                                                           -    - Better resource utilization
                                                                                                                                                                                                                                                                                                                                                                                                                -    - Required for scaling to 10M+ tokens
                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                     - 4. **Pydantic Models** for type safety:
                                                                                                                                                                                                                                                                                                                                                                                                                       5.    - RLMConfig, RLMResponse, chunks
                                                                                                                                                                                                                                                                                                                                                                                                                             -    - Automatic validation
                                                                                                                                                                                                                                                                                                                                                                                                                                  -    - Easy serialization to JSON
                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                       - ### Challenges Encountered
                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                       - 1. **Region Mismatch Initially**
                                                                                                                                                                                                                                                                                                                                                                                                                                         2.    - Solution: Verified UK South in project settings
                                                                                                                                                                                                                                                                                                                                                                                                                                               -    - Lesson: Always verify region at resource creation
                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                    - 2. **Model Availability**
                                                                                                                                                                                                                                                                                                                                                                                                                                                      3.    - GPT-5.2 not in UK South
                                                                                                                                                                                                                                                                                                                                                                                                                                                            -    - Solution: User provided alternative models list
                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -    - Lesson: Check model availability by region
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - 3. **Service Choice Confusion**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        4.    - Initially considered Azure Portal OpenAI
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              -    - User correction: Use Foundry exclusively
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -    - Lesson: Foundry is the modern, recommended service
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ## üìö File Dependencies
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ```
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        rlm_engine.py
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îú‚îÄ‚îÄ context_manager.py (imports: ContextManager, TokenCounter)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îú‚îÄ‚îÄ config.py (TODO - imports: RLMConfig)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îî‚îÄ‚îÄ azure.openai (imports: AzureOpenAI, AsyncAzureOpenAI)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        function_app.py (TODO)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îú‚îÄ‚îÄ rlm_engine.py (imports: RLMEngine, RLMConfig)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îú‚îÄ‚îÄ context_manager.py (imports: ContextManager)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îî‚îÄ‚îÄ azure.functions (imports: HttpRequest, HttpResponse)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        tests/test_rlm_engine.py (TODO)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îú‚îÄ‚îÄ rlm_engine.py (test: RLMEngine, RLMConfig, RLMResponse)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îî‚îÄ‚îÄ context_manager.py (test: ContextManager, TokenCounter)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Dockerfile (TODO)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îî‚îÄ‚îÄ requirements.txt (base for dependencies)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        copilot_integration.py (TODO)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îú‚îÄ‚îÄ rlm_engine.py (imports: RLMEngine)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îî‚îÄ‚îÄ azure.functions (webhook handler)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        clients/*.py (TODO)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‚îî‚îÄ‚îÄ function_app.py (target API endpoints)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ```
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ## üéì How to Continue
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ### For Next Developer/Session
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        1. **Review This Document**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        2.    - Understand architecture and decisions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              -    - Check critical requirements section
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -    - Note file dependencies
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - 2. **Examine Completed Files**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          3.    - Start with SETUP.md (understand deployment)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -    - Read rlm_engine.py (core logic)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     -    - Study context_manager.py (context handling)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - 3. **Follow Priority Order**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            4.    - Create config.py next (small, required by others)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  -    - Then function_app.py (API endpoints)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -    - Then Dockerfile (deployment)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - 4. **Testing**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              5.    - Run locally with `.env` credentials
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -    - Test RLMEngine.process_query() with sample documents
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -    - Verify token counting and chunking
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - 5. **Continue via Browser**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                6.    - Use GitHub web editor for visual control
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      -    - Each file: create ‚Üí edit ‚Üí commit
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           -    - Typical time per file: 5-15 minutes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ## üìû Quick Reference
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ### Environment Variables (from .env.example)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ```
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                FOUNDRY_ENDPOINT=https://<region>.api.azureml-test.net
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                FOUNDRY_API_KEY=<your-key>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                AZURE_SUBSCRIPTION_ID=<sub-id>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                MAX_TOKENS=10000000
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CHUNK_SIZE=100000
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ```
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ### Key Classes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - **RLMEngine:** Main orchestrator for query processing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - - **RLMConfig:** Configuration container
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - - **RLMResponse:** Response model (status, result, reasoning_steps)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - - **ContextManager:** Document chunking and optimization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - - **TokenCounter:** Token estimation utility
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - ### Key Methods
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - - `RLMEngine.process_query(query, documents)` - Main entry point
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - - `ContextManager.optimize_context(documents, query)` - Context optimization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - - `ContextManager.chunk_documents(documents)` - Document splitting
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - - `ContextManager.select_relevant_chunks(chunks, query)` - Relevance filtering
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ## ‚úÖ Verification Checklist
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Before deploying to Azure:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] All files created and committed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Local .env file configured with real Foundry credentials
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] rlm_engine.py executes without import errors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] context_manager.py chunk logic works correctly
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Foundry agents accessible and responding
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Azure Functions deployment tested
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Docker image builds successfully
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Unit tests passing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Integration tests passing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Application Insights configured
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - [ ] Documentation complete
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] ## üìö References
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - **MIT RLM Paper:** https://arxiv.org/html/2512.24601v1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - **Azure Foundry:** https://ai.azure.com
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - **Azure Functions Docs:** https://learn.microsoft.com/azure/azure-functions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - **OpenAI Python SDK:** https://github.com/openai/openai-python
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] - **Pydantic Docs:** https://docs.pydantic.dev
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] ## üìå Important Notes for Future Sessions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 1. **Subscription No.2** - Verify in Azure portal every time
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 2. **UK South Region** - All resources must be here
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 3. **Foundry Not Portal** - Use ai.azure.com, not Azure Portal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 4. **GPT-5.1-chat** - Current model of choice
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 5. **Async Everything** - Maintain async/await pattern
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 6. **Error Logging** - Always log errors for debugging
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 7. **Token Estimation** - Use CHARS_PER_TOKEN = 4 throughout
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 8. **Document Metadata** - Track chunk_id, relevance_score, etc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] **Last Updated:** 2026-01-18 11:14:54
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] **Next Expected Completion:** 2026-01-18 12:30:00 (with continued browser-based file creation)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] **Estimated Remaining Effort:** ~90 minutes for 12 remaining files
